/* core version: 1.0.0 */
!function(a){var b=function(a,b){function c(a,b){var c=document.createElement(a);return c.innerText=b,c}function d(a,b,d){for(var f in a)d.appendChild("object"!=typeof a[f]?c(b,a[f]):e(a[f],b))}function e(a,b){var f=document.createElement(b);for(var g in a)a[g]instanceof Array?d(a[g],g,f):f.appendChild("object"!=typeof a[g]?c(g,a[g]):e(a[g],g));return f}return e(a,b)};a.toXML=b}(JSON);var XML={};!function(a){function b(a){var b=isNaN(a.textContent)?a.textContent:parseFloat(a.textContent);return b}function c(a){for(var d={},e=0;e<a.length;e++){var f=a[e],g=f.tagName.toLowerCase();d[g]&&!Object.isArray(d[g])&&(d[g]=[d[g]]);var h=c(f.children)||b(f);Object.isArray(d[g])?d[g].push(h):d[g]=h}return Object.isEmpty(d)?null:d}a.toJSON=function(a){return c(a.children)}}(XML),String.prototype.replaceAt=function(a,b){return this.substr(0,--a)+b+this.substr(a+b.length)},String.prototype.insertAt=function(a,b){return this.substr(0,a)+b+this.substr(a)},String.prototype.removeAt=function(a,b){return b="undefined"==typeof b?1:b,this.substr(0,--a)+this.substr(a+b)},String.prototype.padLeft=function(a,b){return 0===a?"":(Array(a+1).join(b)+this).slice(-a)},String.prototype.padRight=function(a,b){return 0===a?"":(this+Array(a+1).join(b)).slice(0,a)},String.prototype.removeHTMLTags=function(){return this.replace(/<\/?[^>]+(>|$)/g,"")},String.prototype.startsWith=function(a){return this.substr(0,a.length)===a},String.prototype.highlightWord=function(a,b,c){b=b||"strong";var d=new RegExp("("+a+")","gi");return strClass=c?' class="'+c+'"':"",this.replace(d,"<"+b+strClass+">$1</"+b+">")},String.prototype.isTime=function(){return/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/.test(this)},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1).toString().toLowerCase()},Array.prototype.indexOf=function(a,b){for(var c=b||0;c<this.length;c++)if(this[c]===a)return c;return-1},Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null==this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=0;f>d;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}}),Number.prototype.toFixed=function(a){var b=this.toString().split("."),c=b[0],d=b[1]||"";return d=d.padRight(a,"0"),""===d?c:c+"."+d},Object.isEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},Object.isArray=function(a){return a instanceof Array},HTMLElement.prototype.addClass=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a].trim();this.className?this.className.match(b)||(this.className+=" "+b):this.className=b}},HTMLElement.prototype.removeClass=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a].trim();this.className.match(b)&&(this.className=this.className.replace(b,"").replace(/\s\s/g," ").trim())}},HTMLElement.prototype.hasClass=function(a){return this.className.match(a)},HTMLElement.prototype.toggleClass=function(a){this.hasClass(a)?this.removeClass(a):this.addClass(a)};var Class=function(){};!function(a){function b(a){return a&&-1===a.toString().indexOf("native code")}a.create=function(a){return c(new Class,a||{})},a.extend=function(a){return{create:function(b){return c(new a,b||{})},CollectionOf:function(b){return{create:function(d){var e=c(new a,f(b));return c(new e,d||{})}}}}};var c=function(a,b){var c=g(b.constructor,a.constructor,b.constructor);c.prototype=a;for(var d in b)c.prototype[d]=g(b[d],a[d],b[d]);return c.prototype.constructor=c,c};a.CollectionOf=function(a){return{create:function(b){return c(f(a),b||{})}}};var d=function(a,b){for(var c=[],d=0;d<a.length;d++)c.push({a1:a[d],a2:b[d]});c.sort(function(a,b){return a.a1<b.a1?-1:a.a1===b.a1?0:1});for(var e=0;e<c.length;e++)a[e]=c[e].a1,b[e]=c[e].a2},e=function(a,b,c){var d=a.splice(c,1,a[b]);a[b]=d[0]},f=function(a){var b={constructor:function(b){this.items=[],this.keys=[];for(var c in b)this.items.push(new a(b[c])),this.keys.push(c)},size:function(){return this.items?this.items.length:0},isEmpty:function(){return 0===this.size()},add:function(a,b){var c="undefined"==typeof b?this.size():b;return this.keys.push(c),this.items.push(a),a},sort:function(){d(this.keys,this.items)},"new":function(b){var c=new a;return this.add(c,b),c},get:function(a){return this.items[this.keys.indexOf(a)]},getAt:function(a){return this.items[a]},set:function(a,b){var c=this.keys.indexOf(a);return this.items[c]=b,c},setAt:function(a,b){return this.items[a]=b,this.keys[a]},getLast:function(a){return this.items[this.keys.lastIndexOf(a)]},swap:function(a,b){e(this.items,a,b),e(this.keys,a,b)},getCollection:function(b,c){var d=new(Class.CollectionOf(a).create());return this.each(function(a,e,f){f[b]===c&&d.add(f,e)}),d},indexOf:function(a){return this.items.indexOf(a)},clone:function(){var b=new(Class.CollectionOf(a).create());return this.each(function(a,c,d){b.add(d,c)}),b},addCollection:function(a){var b=this;a.each(function(a,c,d){b.add(d,c)})},remove:function(a){var b,c=0;do c=this.keys.indexOf(a),-1!==c&&(this.keys.splice(c,1),b=this.items.splice(c,1));while(-1!==c);return b[0]||null},removeAt:function(a){return this.keys.splice(a,1),this.items.splice(a,1)[0]},removeItem:function(a){var b="";return this.each(function(c,d,e){a===e&&(b=d)}),this.remove(b)},filter:function(b){var c=new(Class.CollectionOf(a).create());return this.each(function(a,d,e){d===b&&c.add(e,b)}),c},each:function(a){for(var b in this.items)a.call(this,parseInt(b,10),this.keys[b],this.items[b])},clear:function(){this.items=[],this.keys=[]}};return b},g=function(a,c,d){return"function"==typeof d?function(){return this["super"]=c,b(a)?a.apply(this,arguments):c.apply(this,arguments)}:d}}(Class);var eventBus,EventBus;!function(){var a=Class.create({constructor:function(a,b,c,d){this.callback=c,this.scope=b,this.name=a,this.once=d},triggerEvent:function(){this.callback.apply(this.scope,arguments)}});EventBus=Class.CollectionOf(a).create({on:function(b,c,d){return this.add(new a(b,c,d,!1))},once:function(b,c,d){return this.add(new a(b,c,d,!0))},off:function(a){var b=[];this.getCollection("name",a).each(function(a,c){b.push(c)});for(var c in b)this.remove(b[c])},trigger:function(a){var b=this,c=Array.prototype.slice.call(arguments,1);return this.getCollection("name",a).each(function(a,d,e){e.triggerEvent.apply(e,c),e.once&&b.remove(d)})}}),eventBus=new EventBus}();var Promise,Promises;!function(){var a=0,b=1,c=2,d=Class.CollectionOf(Function).create({constructor:function(){this["super"](),this.id=-1,this.status=a,this.returnData=[]},setStatus:function(a){this.status=a},isStatus:function(a){return this.status===a},setAction:function(a,b){this.add(b,a)},getActions:function(a){return this.filter(a)},eachAction:function(a,b){this.getActions(a).each(function(a,c,d){b.call(this,a,c,d)})},hasActions:function(a){return!this.filter(a).isEmpty()},setData:function(a,b){this.returnData[a]=b},getData:function(a){return this.returnData[a]},finalize:function(a,b){var c=this;this.setData(a,b),this.setStatus(a),this.eachAction(a,function(a,d,e){e.call(c,b,c.id)})},callAction:function(a,b){var c=this;this.isStatus(a)?b.call(c,c.getData(a),c.id):this.setAction(a,b)}});Promise=Class.extend(d).create({constructor:function(){this["super"]()},resolve:function(a){this.finalize(b,a)},unresolvable:function(a){this.finalize(c,a)},onDone:function(a){return this.callAction(b,a),this},onFail:function(a){return this.callAction(c,a),this}});var e=Class.CollectionOf(Promise).create({constructor:function(b){this["super"](b),this.done=null,this.fail=function(){},this.args=[],this.errors=[],this.count=0,this.counter=0,this.importsCounter=0,this.status=a},setStatus:function(a){this.status=a},isStatus:function(a){return this.status===a},setData:function(a,c,d){a===b?this.args[d]=c:this.errors.push(c)},getData:function(a){var c=this.errors;return a===b&&(c=this.args.slice(-this.importsCounter),c=c.concat(this.args.slice(0,this.importsCounter+1))),c},finalize:function(a,b){b&&b.apply(this,this.getData(a))},setAction:function(a,c){a===b?this.done=c:this.fail=c},callAction:function(a,b){this.status===a?this.finalize(a,b):this.setAction(a,b)}});Promises=Class.extend(e).create({constructor:function(a,b){this["super"](b),this.minimum=a||0},add:function(a,b){this["super"](a,b);var c=this;a.id=this.counter++,a.onDone(function(a,b){c.itemOnDone(a,b)}),a.onFail(function(a){c.itemOnFail(a)})},itemOnDone:function(a,c){this.count+=1,this.setData(b,a,c),this.count===Math.max(this.minimum,this.size())&&(this.setStatus(b),this.finalize(b,this.done))},itemOnFail:function(a){this.setData(c,a),this.setStatus(c),this.finalize(c,this.fail)},onDone:function(a){return this.callAction(b,a),this},onFail:function(a){return this.callAction(c,a),this},imports:function(a,b){return this.importsCounter++,this.add(b.retrievePackage(b.getFullName(a))),this}})}();var Package=Class.extend(Promise).create({constructor:function(a){this["super"](),this.data={},this.name=a,this.promises=new Promises},setCallback:function(a){var b=this;this.promises.onDone(function(){var c=Array.prototype.slice.call(arguments,1),d=a.apply(b.data,c);d&&(b.data=d),b.resolve(b.data)})},addPromise:function(a){this.promises.add(a)}}),packStorage=new(Class.CollectionOf(Package).create()),Packages=Class.create({constructor:function(a){this["super"](),this.imported=[],this.type=a},create:function(a,b){var c=this.retrievePackage(this.getFullName(a)),d=new Promise;c.addPromise(d);for(var e in this.imported)c.addPromise(this.retrievePackage(this.imported[e]));c.setCallback(b),d.resolve(),this.imported.length=0},imports:function(a){return this.imported.push(this.getFullName(a)),this},from:function(a){var b=this.imported.length-1,c=this.imported[b];return this.imported[b]=a+c.substr(c.indexOf(":")),this},getPackage:function(a){return packStorage.get(this.getFullName(a))?packStorage.get(this.getFullName(a)).data:null},getFullName:function(a){return this.type+":"+a},each:function(a){var b=0,c=this,d=this.type.length;packStorage.each(function(e,f,g){f.startsWith(c.type)&&(a.call(c,b,f.substr(d+1),g),b++)})},retrievePackage:function(a){if(packStorage.get(a))return packStorage.get(a);var b=new Package(a);return packStorage.add(b,a),b}}),packages=new Packages("packages"),components=new Packages("components"),Component,models=new Packages("models"),Model;!function(){function a(a,b,c,d){a.__callbacks=a.__callbacks||[],a.__wrappedCallbacks=a.__wrappedCallbacks||[],a.__callbacks.push(c);var e=function(a){c.call(d,a)};a.__wrappedCallbacks.push(e),a.addEventListener(b,e)}function b(a,b,c){var d=a.__callbacks.indexOf(c);a.removeEventListener(b,a.__wrappedCallbacks[d]),a.__callbacks.splice(d,1),a.__wrappedCallbacks.splice(d,1)}var c=new EventBus,d=Class.create({constructor:function(a){this.htmlNode=a},addClass:function(){this.htmlNode.addClass.apply(this.htmlNode,arguments)},removeClass:function(){this.htmlNode.removeClass.apply(this.htmlNode,arguments)},toggleClass:function(a){this.htmlNode.toggleClass(a)},hasClass:function(a){return this.htmlNode.hasClass(a)},focus:function(){this.htmlNode.focus()},value:function(a){var b="INPUT"===this.htmlNode.tagName||"TEXTAREA"===this.htmlNode.tagName?"value":"textContent";return a&&(this.htmlNode[b]=a),this.htmlNode[b]},on:function(a,b){-1===a.indexOf(":")&&this.componentName&&(a=this.componentName+":"+a),c.on(a,this,b)},trigger:function(){var a=Array.prototype.slice.call(arguments,1),b=[this.componentName+":"+arguments[0]];c.trigger.apply(c,b.concat(a))},attribute:function(a,b){this.htmlNode.setAttribute(a,b)},css:function(a,b){if("undefined"==typeof b){var c=window.getComputedStyle(this.htmlNode,null).getPropertyValue(a).match(/\d+/);return c?parseInt(c[0]):0}this.htmlNode.style[a]=""+b+"px"}});Component=Class.extend(d).CollectionOf(Object).create({constructor:function(a,b){this["super"](),a&&(this.nodeId=a.id||null,this.bindings=new g,this.componentName=this.componentName||a.getAttribute("data-component"),this.__setTemplate(a),this.__saveStaticData(a,b),this.htmlNode=this.__replaceTemplate(a),this.__parseNodes(),this.__fillData(),this.model.triggerChange(),this.__render())},modelChange:function(a,b){b===this.model&&this.bindings.getCollection("itemName",a).each(function(a,c,d){"value"===d.type?d.value(b.get(d.itemName)):d.attribute(d.type,b.get(d.itemName))})},addBinding:function(a,b,c){this.bindings.add(new f(a,b,c))},__setTemplate:function(a){var b=a.cloneNode(!0);b.removeAttribute("data-component"),b.removeAttribute("id"),this.template=templates[this.componentName]||b.outerHTML},__saveStaticData:function(a,b){this.model=b||new Model({}),!b&&templates[this.componentName]&&(this.model=new Model(XML.toJSON(a)||{}))},__replaceTemplate:function(a){var b=document.createElement("div");b.innerHTML=this.template;var c=b.children[0];return this.nodeId&&c.setAttribute("id",this.nodeId),a.parentNode.insertBefore(c,a.nextSibling),a.parentNode.removeChild(a),c},__parseNodes:function(){i(this.htmlNode,this)},__fillData:function(){var a=this;this.model.each(function(b,c,d){a.get(c)&&d instanceof p&&d.each(function(b,d,e){a.get(c).newItem(e)})})},__render:function(){this.htmlNode.setAttribute("ready",""),this.componentName&&this.htmlNode.addClass("components",this.componentName)},addListener:function(b,c,d){c.split(",").forEach(function(c){a(b,c,d,this)},this)},removeListener:function(a,c,d){c.split(",").forEach(function(c){b(a,c,d)})}});var e=Class.extend(d).create({constructor:function(a){this["super"](a),a&&a.removeAttribute("data-item")}}),f=Class.extend(d).create({constructor:function(a,b,c){this["super"](a),this.type=b,this.itemName=c,a.removeAttribute("data-bind")}}),g=Class.CollectionOf(f).create(),h=Class.CollectionOf(Component).create({constructor:function(a,b,c){this["super"](),this.container=a,b.removeAttribute("data-collection"),this.htmlNode=b,this.componentName=c,this.container.removeChild(b)},newItem:function(a){var b=this.htmlNode.cloneNode(!0);this.container.appendChild(b),b.setAttribute("data-component",this.componentName);var c=components.getPackage(this.componentName)||Component,d=new c(b,a);return this.add(d),d}}),i=function(a,b){o(this,a,function(a){var c=!0,d=a.getAttribute("data-item");return d&&j(a,d,b),d=a.getAttribute("data-bind"),d&&(d=d.split(":"),k(a,d[0],d[1],b)),d=a.getAttribute("data-listener"),d&&l(a,d,b),d=a.getAttribute("data-component"),d&&(m(a,d,b),c=!1),d=a.getAttribute("data-collection"),d&&(n(a,d,b),c=!1),c})},j=function(a,b,c){a.setAttribute("ready",""),c.add(new e(a),b)},k=function(a,b,d,e){a.setAttribute("ready",""),e.addBinding(a,b,d),c.get("model:"+d+":change")||e.on("model:"+d+":change",e.modelChange)},l=function(a,b,c){b=b.split(":"),c.addListener(a,b[1],c[b[0]])},m=function(a,b,c){var d=components.getPackage(b)||Component;return c.add(new d(a,c.model[b]),b),!1},n=function(a,b,c){var d;-1!==b.indexOf(":")&&(d=b.substr(0,b.indexOf(":")),b=b.substr(b.indexOf(":")+1)),c.add(new h(a.parentNode,a,d),b)},o=function(a,b,c){for(var d=0;d<b.children.length;d++){var e=b.children[d],f=c.call(a,e);f&&e.children.length>0&&o(a,e,c)}};Model=Class.CollectionOf(Object).create({constructor:function(a){this["super"](),this.parseData(a)},parseData:function(a){for(var b in a){var c=a[b];c instanceof Array&&!(c instanceof Date)?this.add(new p(c),b):c instanceof Object&&!(c instanceof Date)?this.add(new Model(c),b):this.add(c,b)}},set:function(a,b){this["super"](a,b),c.trigger("model:"+a+":change",a,this)},setAt:function(a,b){var d=this["super"](a,b);c.trigger("model:"+d+":change",d,this)},triggerChange:function(){this.each(function(a,b,d){d instanceof p?d.each(function(a,b,c){c.triggerChange()}):d instanceof Model?d.triggerChange():c.trigger("model:"+b+":change",b,this)})}});var p=Class.CollectionOf(Model).create({constructor:function(a){this["super"](a)}})}();